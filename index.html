<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Web Record APP</title>
      <script type="text/javascript" src="https://alex5250.github.io/ZeptoScreen/main.js"></script>
      <style type="text/css" src="https://cdn.jsdelivr.net/npm/cirrus-ui@0.5.5/dist/cirrus.min.css"></style>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css"  crossorigin="anonymous">
      <nav class="navbar" role="navigation" aria-label="main navigation">
         <div class="navbar-brand">
            <h1 style="">ZeptaScreen </h1>
            <style type="text/css" media="screen">
               h1 {
               font-size:30px; 
               text-align: center;
               margin-left: auto;
               margin-right: auto;
               width: 50em;
               }
            </style>
            </a>
            </a>
         </div>
      </nav>
      <div class="card">
         <header class="card-header">
            <a href="#" class="card-header-icon" aria-label="more options">
            <span class="icon">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
            </span>
            </a>
         </header>
         <div class="card-content">
            <div class="content">
               </p>
               <video id="video" autoplay></video>
               <style>
                  #video {
                  margin-left: auto;
                  margin-right: auto;
                  display: block
                  }
               </style>
               <br>
            </div>
         </div>
         <style>
            .button {
            margin: 10px;
            }
            .log {
            visibility: hidden;
            }
         </style>
         <footer class="card-footer">
            <div class="field is-grouped" id="centrerd">
               <p class="control">
                  <button class="button is-link" id="start">
                  Select window
                  </button>
                  <button class="button is-link" id="stop">
                  Stop
                  </button>
               </p>
               <p class="control" onclick="start()">
                  <button class="button">
                  Start
                  </button>
               </p>
               <br>
               <p class="control" onclick="download()">
                  <button class="button is-danger">
                  Downland
                  </button>
               </p>
            </div>
            <style>
               #centrerd {
               margin: auto;
               width: 50%;
               padding: 10px;
               }
            </style>
         </footer>
      </div>
      <script type="text/javascript">
         var options = {mimeType: 'video/webm;codecs=h264'}; 
            const canvas = document.getElementById('video');
         const recorder = new CanvasRecorder(canvas,45000000);
         
      </script>
      <script type="text/javascript">
         const videoElem = document.getElementById("video");
         
         const startElem = document.getElementById("start");
         const stopElem = document.getElementById("stop");
         
         // Options for getDisplayMedia()
         
         var displayMediaOptions = {
          video: {
            cursor: "always"
          },
          audio: false
         };
         
         // Set event listeners for the start and stop buttons
         startElem.addEventListener("click", function(evt) {
          startCapture();
         }, false);
         
         stopElem.addEventListener("click", function(evt) {
          stopCapture();
         }, false);
         
         //console.log = msg => logElem.innerHTML += `${msg}<br>`;
         // console.error = msg => logElem.innerHTML += `<span class="error">${msg}</span><br>`;
         // console.warn = msg => logElem.innerHTML += `<span class="warn">${msg}<span><br>`;
         //console.info = msg => logElem.innerHTML += `<span class="info">${msg}</span><br>`;
          function start() {
         
         recorder.start();
         alert("Started recording");
         }
         function stop() {
          recorder.stop();
          alert("Stopped recording");
         }
         function download() {
          recorder.save('screen_record.webm');
         }
         async function startCapture() {
         
         
          try {
            videoElem.srcObject = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
            dumpOptionsInfo();
            
            
         
          } catch(err) {
            console.error("Error: " + err);
            
          }
         }
         
         function stopCapture(evt) {
          let tracks = videoElem.srcObject.getTracks();
         
          tracks.forEach(track => track.stop());
          videoElem.srcObject = null;
          stop();
         }
         
         function dumpOptionsInfo() {
          const videoTrack = videoElem.srcObject.getVideoTracks()[0];
         
          console.info("Track settings:");
          console.info(JSON.stringify(videoTrack.getSettings(), null, 2));
          console.info("Track constraints:");
          console.info(JSON.stringify(videoTrack.getConstraints(), null, 2));
         }
      </script>
      <style>
      #video {
      border: 1px solid #999;
      width: 98%;
      max-width: 860px;
      }
      .error {
      color: red;
      }
      .warn {
      color: orange;
      }
      .info {
      color: darkgreen;
      }
      <style>
      </body>
</html>
